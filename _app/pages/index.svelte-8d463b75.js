import{L as W,M as X,S as K,i as Q,s as U,e as y,t as V,c as w,a as b,h as B,d as f,g as d,J as T,j as F,b as q,k as S,m as N,N as H,O,P,K as A,Q as $,R as z,v as G,T as Y,U as Z,V as x,W as ee,X as te}from"../chunks/vendor-90dfa8bf.js";/* empty css                    */import{a as I}from"../chunks/paths-c0fc83a9.js";function R(n,e,a){const s=n.slice();return s[14]=e[a],s}function C(n){let e,a=n[14].name+"",s,o;return{c(){e=y("option"),s=V(a),this.h()},l(l){e=w(l,"OPTION",{});var p=b(e);s=B(p,a),p.forEach(f),this.h()},h(){e.__value=o=n[14],e.value=e.__value},m(l,p){d(l,e,p),T(e,s)},p(l,p){p&1&&a!==(a=l[14].name+"")&&F(s,a),p&1&&o!==(o=l[14])&&(e.__value=o,e.value=e.__value)},d(l){l&&f(e)}}}function J(n){let e,a,s;return{c(){e=y("p"),a=y("textarea"),this.h()},l(o){e=w(o,"P",{});var l=b(e);a=w(l,"TEXTAREA",{class:!0}),b(a).forEach(f),l.forEach(f),this.h()},h(){a.value=s="/profile/"+n[2],q(a,"class","svelte-nosqjc")},m(o,l){d(o,e,l),T(e,a)},p(o,l){l&4&&s!==(s="/profile/"+o[2])&&(a.value=s)},d(o){o&&f(e)}}}function ae(n){let e,a,s,o,l,p,h=n[0],i=[];for(let t=0;t<h.length;t+=1)i[t]=C(R(n,h,t));let c=n[2]&&J(n);return{c(){e=y("select");for(let t=0;t<i.length;t+=1)i[t].c();a=S(),c&&c.c(),s=S(),o=y("div"),this.h()},l(t){e=w(t,"SELECT",{});var u=b(e);for(let r=0;r<i.length;r+=1)i[r].l(u);u.forEach(f),a=N(t),c&&c.l(t),s=N(t),o=w(t,"DIV",{id:!0,class:!0}),b(o).forEach(f),this.h()},h(){n[1]===void 0&&H(()=>n[4].call(e)),q(o,"id","profile"),q(o,"class","svelte-nosqjc")},m(t,u){d(t,e,u);for(let r=0;r<i.length;r+=1)i[r].m(e,null);O(e,n[1]),d(t,a,u),c&&c.m(t,u),d(t,s,u),d(t,o,u),l||(p=[P(e,"change",n[4]),P(e,"change",n[5])],l=!0)},p(t,[u]){if(u&1){h=t[0];let r;for(r=0;r<h.length;r+=1){const E=R(t,h,r);i[r]?i[r].p(E,u):(i[r]=C(E),i[r].c(),i[r].m(e,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=h.length}u&3&&O(e,t[1]),t[2]?c?c.p(t,u):(c=J(t),c.c(),c.m(s.parentNode,s)):c&&(c.d(1),c=null)},i:A,o:A,d(t){t&&f(e),$(i,t),t&&f(a),c&&c.d(t),t&&f(s),t&&f(o),l=!1,z(p)}}}const se="https://raw.githubusercontent.com/ONSvisual/census-data-v2/main/csv/lists/places_2021.csv";async function pe({fetch:n}){let a=await(await n(se)).text(),s=W(a,X);return s.sort((o,l)=>o.name.localeCompare(l.name)),{props:{places:s}}}async function le(n){return await(await fetch(`https://raw.githubusercontent.com/ONSvisual/census-data-v2/main/json/place/${n}.json`)).json()}async function ne(n){const e=["population","density","agemed","age10yr","ethnicity"];let a=[];return e.forEach(s=>{a.push({key:s,vals:n.data[s].value["2011"]})}),console.log(a),a}function oe(n,e,a){let{places:s}=e,o,l,p,h,i,c,t=s[0],u;function r(_,k){let v=[];return _.forEach(m=>{typeof m=="number"?v.push(te(m,k)):Array.isArray(m)?v.push(r(m,k)):v.push(m)}),v}async function E(_){let k=`PREFIX geosparql: <http://www.opengis.net/ont/geosparql#>
SELECT ?geometry
WHERE {
  <http://statistics.data.gov.uk/id/statistical-geography/${_}/geometry> geosparql:asWKT ?geometry
}
LIMIT 1`,M=(await(await fetch("https://pmd3-production-drafter-onsgeo.publishmydata.com/v1/sparql/live?query="+encodeURIComponent(k))).text()).split(`
`)[1].replaceAll('"',""),g=x.parse(M);return g=ee(g,{highQuality:!0,tolerance:.001}),g.coordinates=r(g.coordinates,4),g}async function j(_){l=await le(_),p=l.name,i=await E(_),c=l.bounds,h=await ne(l),a(2,u=`?name=${p}&tabs=${btoa(JSON.stringify(h))}&poly=${btoa(JSON.stringify(i))}&bbox=${btoa(JSON.stringify(c))}`),o?window.open(I+"/profile/"+u,"profile"):o=new Y.Parent("profile",I+"/profile/"+u,{name:"profile",id:"iframe"})}G(()=>j(t.code));function L(){t=Z(this),a(1,t),a(0,s)}const D=()=>j(t.code);return n.$$set=_=>{"places"in _&&a(0,s=_.places)},[s,t,u,j,L,D]}class fe extends K{constructor(e){super();Q(this,e,oe,ae,U,{places:0})}}export{fe as default,pe as load};
